{% extends "base.html" %}
{% block content %}
<h2>Статистика</h2>

<h4>Статистика по статусам</h4>
<form method="get" class="d-flex gap-2 align-items-center mb-3 flex-wrap">

  <select name="period" onchange="this.form.submit()" class="form-select w-auto">
    <option value="">За всё время</option>
    <option value="today" {% if period == 'today' %}selected{% endif %}>Сегодня</option>
    <option value="yesterday" {% if period == 'yesterday' %}selected{% endif %}>Вчера</option>
    <option value="week" {% if period == 'week' %}selected{% endif %}>Последняя неделя</option>
    <option value="month" {% if period == 'month' %}selected{% endif %}>Текущий месяц</option>
    <option value="custom" {% if period == 'custom' %}selected{% endif %}>Выбрать даты</option>
  </select>

  {% if period == 'custom' %}
  <input type="date" name="date_from" value="{{ date_from }}" class="form-control form-control-sm" style="max-width: 140px;">
  <input type="date" name="date_to" value="{{ date_to }}" class="form-control form-control-sm" style="max-width: 140px;">
  <button type="submit" class="btn btn-primary btn-sm">Применить</button>
  {% endif %}

</form>


<table class="table table-bordered w-50">
    <thead><tr><th>Статус</th><th>Количество</th></tr></thead>
    <tbody>
        {% for status, count in status_stats %}
            <tr><td>{{ status }}</td><td>{{ count }}</td></tr>
        {% else %}
            <tr><td colspan="2" class="text-center">Нет данных</td></tr>
        {% endfor %}
    </tbody>
</table>

<h4>Статистика по отделам</h4>
<table class="table table-bordered w-50">
    <thead><tr><th>Отдел</th><th>Количество</th></tr></thead>
    <tbody>
        {% for dept, count in dept_stats %}
            <tr><td>{{ dept }}</td><td>{{ count }}</td></tr>
        {% else %}
            <tr><td colspan="2" class="text-center">Нет данных</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
