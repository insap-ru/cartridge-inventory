{% extends "base.html" %}
{% block content %}
<h2>Картриджи</h2>

<form method="get" class="mb-3 d-flex gap-2 flex-wrap">
    <select name="department" class="form-select w-auto">
        <option value="">Все отделы</option>
        {% for d in departments %}
        <option value="{{ d.id }}" {% if selected_department == d.id|string %}selected{% endif %}>{{ d.name }}</option>
        {% endfor %}
    </select>
    <select name="model" class="form-select w-auto">
    <option value="">Все модели</option>
    {% for m in models %}
        <option value="{{ m.id }}" {% if selected_model == m.id|string %}selected{% endif %}>{{ m.name }}</option>
    {% endfor %}
</select>
    <select name="status" class="form-select w-auto">
        <option value="">Любой статус</option>
        <option value="Используется" {% if request.args.get('status') == 'Используется' %}selected{% endif %}>Используется</option>
        <option value="Новый" {% if request.args.get('status') == 'Новый' %}selected{% endif %}>Новый</option>
        <option value="Списан" {% if request.args.get('status') == 'Списан' %}selected{% endif %}>Списан</option>
    </select>
    <input type="text" name="serial" class="form-control w-auto" placeholder="Инвентарный номер" value="{{ request.args.get('serial', '') }}">
    <button type="submit" class="btn btn-primary">Фильтр</button>
    
</form>


<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Модель</th>
            <th>Инвентарный номер</th>
            <th>Статус</th>
            <th>Отдел</th>
            <th>Принтер (Инв.№)</th>
            <th>Дата и время назначения</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
{% for c in cartridges %}
    <tr>
        <td>{{ c.id }}</td>
        <td>{{ c.model }}</td>
        <td>{{ c.serial_number }}</td>
        <td>{{ c.status }}</td>
        <td>{{ c.department }}</td>
        <td>{{ c.printer_model }}</td>
        <td>
            {% if c.assigned_datetime %}
                {{ c.assigned_datetime }}
            {% else %}
                Не назначен
            {% endif %}
        </td>
        <td>
            <a href="{{ url_for('edit_cartridge', id=c.id) }}" class="btn btn-sm btn-warning">Редактировать</a>

            {% if c.status != 'Списан' %}
            <form action="{{ url_for('write_off_cartridge', cartridge_id=c.id) }}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-secondary" onclick="return confirm('Списать картридж?');">Списать</button>
            </form>
            {% if c.status != 'Новый' %}
            <form action="{{ url_for('return_to_new', cartridge_id=c.id) }}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-info" onclick="return confirm('Вернуть картридж в новые?')">В новые</button>
            </form>
            {% endif %}
            {% endif %}
        </td>
    </tr>
{% else %}
    <tr><td colspan="7" class="text-center">Картриджи не найдены</td></tr>
{% endfor %}
</tbody>

</table>
{% endblock %}
